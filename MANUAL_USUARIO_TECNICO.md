# Manual de Usuario y Manual Técnico
## Licorería Al Pasito

---

## Índice

1. [Manual de Usuario](#manual-de-usuario)
2. [Manual Técnico](#manual-técnico)

---

# MANUAL DE USUARIO

## 1. Introducción

**Licorería Al Pasito** es una plataforma web moderna para la compra de bebidas alcohólicas en línea. Esta guía te ayudará a navegar por la aplicación, realizar compras y gestionar tu cuenta.

### Requisitos
- Navegador web actualizado (Chrome, Firefox, Safari, Edge)
- Conexión a Internet
- Crear una cuenta de usuario

---

## 2. Registro e Inicio de Sesión

### 2.1 Crear una cuenta (Registro)

1. Ingresa a la plataforma desde [https://licoreria-pasito.vercel.app](https://licoreria-pasito.vercel.app)
2. Haz clic en el botón **"Registrarse"** en la página de login
3. Completa el formulario con:
   - **Nombre completo**: Tu nombre y apellido
   - **Correo electrónico**: Un correo válido (no debe estar registrado previamente)
   - **Contraseña**: Mínimo 6 caracteres (recomendado: combinar mayúsculas, minúsculas, números y símbolos)
   - **Confirmación de contraseña**: Repetir la misma contraseña
   - Aceptar términos y condiciones
4. Haz clic en **"Crear Cuenta"**
5. Verifica tu correo electrónico (si es requerido)

### 2.2 Iniciar Sesión

1. En la página principal, ingresa:
   - **Correo electrónico**: Tu correo registrado
   - **Contraseña**: Tu contraseña
2. Haz clic en **"Iniciar Sesión"**
3. Si las credenciales son correctas, serás redirigido al dashboard

---

## 3. Navegación Principal

### 3.1 Barras de Navegación

**Para Clientes:**
- **Inicio**: Regresa a la página principal
- **Catálogo**: Visualiza todos los productos disponibles
- **Mi Carrito**: Ve los productos seleccionados (con número de artículos)
- **Mis Órdenes**: Historial de compras realizadas
- **Facturas**: Descarga tus comprobantes
- **Mi Cuenta**: Gestiona tu perfil y preferencias
- **Cerrar Sesión**: Cierra tu sesión actual

**Para Administradores:**
- Todas las opciones anteriores, más:
- **Panel Admin**: Acceso a gestión de productos, órdenes, clientes, pagos, reportes, auditoría, etc.

---

## 4. Catálogo y Búsqueda de Productos

### 4.1 Explorar el Catálogo

1. Haz clic en **"Catálogo"** en la barra de navegación
2. Visualiza todos los productos disponibles en formato de tarjetas
3. Cada tarjeta muestra:
   - Imagen del producto
   - Nombre del producto
   - Precio
   - Disponibilidad (En Stock / Agotado)
   - Botón de acción

### 4.2 Filtrar Productos

En la página de catálogo puedes:
- **Por categoría**: Selecciona una categoría de bebidas (cervezas, vinos, licores, etc.)
- **Por precio**: Usa el rango de precios para filtrar
- **Por disponibilidad**: Mostrar solo productos disponibles
- **Búsqueda**: Usa el buscador para encontrar productos específicos por nombre

### 4.3 Ver Detalles del Producto

1. Haz clic en cualquier tarjeta de producto
2. En la página de detalles verás:
   - Imagen grande del producto
   - Nombre y descripción completa
   - Precio
   - Volumen/Tamaño
   - Contenido de alcohol (%)
   - Disponibilidad en stock
   - Reseñas de otros clientes
   - Calificación (estrellas)

### 4.4 Dejar una Reseña

1. En la página de detalles del producto
2. Desplázate a la sección "Reseñas"
3. Si ya compraste el producto, haz clic en **"Dejar una Reseña"**
4. Ingresa:
   - **Calificación**: Selecciona de 1 a 5 estrellas
   - **Comentario**: Describe tu experiencia
5. Haz clic en **"Enviar Reseña"**

---

## 5. Carrito de Compras

### 5.1 Agregar Productos al Carrito

1. En la página de producto, selecciona la cantidad deseada
2. Verifica que el producto esté disponible en stock
3. Haz clic en el botón **"Agregar al Carrito"**
4. Verás una confirmación de que el producto fue añadido
5. El número en el icono del carrito se actualiza automáticamente

### 5.2 Gestionar el Carrito

1. Haz clic en el icono del **"Carrito"** en la barra de navegación
2. Verás:
   - Lista de productos añadidos
   - Cantidad de cada producto
   - Precio unitario y precio total
   - Botones para aumentar/disminuir cantidad
   - Opción para eliminar productos

### 5.3 Modificar Cantidad

1. En la página del carrito
2. Usa los botones **"+"** y **"-"** para ajustar la cantidad
3. O ingresa directamente la cantidad en el campo
4. El total se actualiza automáticamente

### 5.4 Eliminar Productos

1. En la página del carrito
2. Haz clic en el icono de **"Papelera"** o **"Eliminar"**
3. Confirma la eliminación
4. El producto se retira del carrito

### 5.5 Proceder al Checkout

1. Una vez seleccionados todos los productos
2. Haz clic en el botón **"Proceder al Pago"** o **"Checkout"**
3. Serás dirigido a la página de confirmación de pedido

---

## 6. Proceso de Compra (Checkout)

### 6.1 Confirmación de Pedido

1. En la página de checkout verás:
   - Resumen de productos
   - Cantidades seleccionadas
   - Precios unitarios y total
   - Dirección de entrega
   - Información de contacto

2. Verifica que toda la información sea correcta

### 6.2 Dirección de Entrega

1. Completa o confirma tu dirección:
   - Enviar el link de la ubicacion actual de google maps

### 6.3 Seleccionar Método de Pago

Opciones disponibles:
- **Transferencia bancaria**: Por transferencia al Banco del Pichincha
- **Efectivo contra entrega**: Efectivo al repartidor

### 6.5 Confirmación Final

- Recibirás una página de confirmación con:
  - Número de orden
  - Fecha y hora de la compra
  - Total pagado
  - Resumen de productos
  - Referencia de transacción

- Un correo electrónico con el comprobante será enviado a tu casilla

---

## 7. Gestión de Órdenes

### 7.1 Ver Mis Órdenes

1. Haz clic en **"Mis Órdenes"** en la barra de navegación
2. Visualiza un historial de todas tus compras
3. Cada orden muestra:
   - Número de orden
   - Fecha de compra
   - Estado (Pendiente, Confirmada, Despachada, Entregada, Cancelada)
   - Monto total
   - Botón para ver detalles

### 7.2 Detalles de Orden

1. Haz clic en una orden específica para ver detalles completos:
   - Productos comprados
   - Cantidades
   - Precios
   - Fecha de creación
   - Dirección de entrega
   - Seguimiento del estado
   - Referencia de transacción

### 7.3 Estados de Orden

- **Pendiente**: La orden está en proceso de confirmación
- **Confirmada**: El pago fue verificado
- **Despachada**: El pedido salió del almacén
- **Entregada**: Recibiste tu compra
- **Cancelada**: La orden fue cancelada

### 7.4 Rastrear Entrega

1. En la página de detalles de la orden
2. Si está "Despachada" o "En Entrega", verás:
   - Información del transportista
   - Número de seguimiento
   - Ubicación aproximada del paquete
   - Hora estimada de entrega

### 7.5 Descargar Comprobante

1. En cualquier orden, haz clic en **"Descargar Comprobante"** o **"Factura"**
2. Se descargará un archivo PDF con:
   - Datos del cliente
   - Listado de productos
   - Precios
   - Monto total y impuestos
   - Número de autorización (si aplica)

---

## 8. Facturas

### 8.1 Acceder a Facturas

1. Haz clic en **"Facturas"** en la barra de navegación
2. Verás un historial de todos tus comprobantes
3. Cada fila muestra:
   - Número de factura
   - Fecha
   - Orden relacionada
   - Monto
   - Estado

### 8.2 Descargar Factura

1. Selecciona la factura deseada
2. Haz clic en el botón **"Descargar PDF"**
3. La factura se descargará en formato PDF
4. Puedes guardarla, imprimirla o compartirla

### 8.3 Ver Detalles de Factura

1. Haz clic en la factura para ver:
   - Número de factura y autorización
   - Datos del cliente
   - Datos de emisión
   - Detalle de productos y servicios
   - Totales por impuesto
   - Monto total a pagar

---

## 9. Mi Cuenta

### 9.1 Perfil de Usuario

1. Haz clic en **"Mi Cuenta"** en la barra de navegación
2. Verás tu información personal:
   - Nombre completo
   - Correo electrónico
   - Teléfono
   - Dirección registrada
   - Estado de la cuenta

### 9.2 Editar Perfil

1. Haz clic en **"Editar Perfil"**
2. Modifica los campos que desees:
   - Nombre
   - Teléfono
   - Dirección
   - Ciudad
   - Código postal
3. Haz clic en **"Guardar Cambios"**

### 9.3 Cambiar Contraseña

1. En la página de cuenta, haz clic en **"Cambiar Contraseña"**
2. Ingresa:
   - Tu contraseña actual
   - Nueva contraseña
   - Confirma la nueva contraseña
3. Haz clic en **"Actualizar Contraseña"**
---

## 10. Notificaciones

### 10.1 Centro de Notificaciones

1. Haz clic en el icono de **"Campana"** o **"Notificaciones"** en la barra
2. Verás un listado de todas tus notificaciones:
   - Estado de tus órdenes
   - Nuevas promociones
   - Productos agotados
   - Cambios en tu cuenta
   - Recordatorios

### 10.2 Marcar como Leído

1. Haz clic en una notificación para abrirla
2. Verás los detalles completos
3. Se marcará automáticamente como leída

---

# MANUAL TÉCNICO

## 1. Introducción

Este manual proporciona documentación completa para desarrolladores que trabajan con **Licorería Al Pasito**. Cubre arquitectura, configuración, desarrollo, despliegue y mantenimiento.

---

## 2. Requisitos del Sistema

### Requisitos Mínimos
- **Node.js**: v16 o superior
- **npm**: v7 o superior (o yarn)
- **Git**: Para control de versiones
- **MongoDB**: Atlas o instancia local (v4.4+)
- **Visual Studio Code** o editor de código preferido

### Herramientas Recomendadas
- Postman o Insomnia (prueba de APIs)
- MongoDB Compass (gestor visual de BD)
- Git GUI (SourceTree, GitHub Desktop)

---

## 3. Estructura del Proyecto

```
licoreriapasito/
├── backend/
│   ├── .env                      # Variables de entorno
│   ├── .gitignore
│   ├── package.json
│   ├── package-lock.json
│   └── src/
│       ├── index.js              # Punto de entrada
│       ├── config/
│       │   └── db.js             # Conexión a MongoDB
│       ├── controllers/          # Controladores de lógica de negocio
│       │   ├── auth.controller.js
│       │   ├── product.controller.js
│       │   ├── order.controller.js
│       │   ├── payment.controller.js
│       │   ├── invoice.controller.js
│       │   ├── client.controller.js
│       │   ├── user.controller.js
│       │   ├── notification.controller.js
│       │   ├── review.controller.js
│       │   ├── report.controller.js
│       │   ├── audit.controller.js
│       │   └── settings.controller.js
│       ├── middleware/           # Middleware personalizado
│       │   ├── auth.middleware.js
│       │   └── audit.middleware.js
│       ├── models/               # Esquemas de Mongoose
│       │   ├── Users.js
│       │   ├── Product.js
│       │   ├── Order.js
│       │   ├── Invoice.js
│       │   ├── Payment.js
│       │   ├── Client.js
│       │   ├── Notification.js
│       │   ├── Review.js
│       │   ├── Audit.js
│       │   └── Settings.js
│       ├── routes/               # Definición de rutas
│       │   ├── auth.routes.js
│       │   ├── product.routes.js
│       │   ├── order.routes.js
│       │   ├── payment.routes.js
│       │   ├── invoice.routes.js
│       │   ├── client.routes.js
│       │   ├── user.routes.js
│       │   ├── notification.routes.js
│       │   ├── review.routes.js
│       │   ├── report.routes.js
│       │   ├── audit.routes.js
│       │   └── settings.routes.js
│       ├── scripts/              # Scripts útiles
│       │   ├── createAdmin.js
│       │   ├── seedData.js
│       │   └── fixOrderCategories.js
│       └── utils/                # Funciones auxiliares
│           ├── pdfGenerator.js
│           └── xmlGenerator.js
│
├── frontend/
│   ├── .env                      # Variables de entorno
│   ├── .gitignore
│   ├── package.json
│   ├── vite.config.js
│   ├── tailwind.config.js
│   ├── postcss.config.js
│   ├── index.html                # HTML principal
│   ├── public/                   # Assets estáticos
│   └── src/
│       ├── main.jsx              # Punto de entrada React
│       ├── App.jsx               # Componente raíz
│       ├── index.css             # Estilos globales
│       ├── components/           # Componentes reutilizables
│       │   ├── Navbar.jsx
│       │   └── GoogleMapsLocation.jsx
│       ├── pages/                # Páginas (componentes principales)
│       │   ├── Home.jsx
│       │   ├── Login.jsx
│       │   ├── Register.jsx
│       │   ├── Catalog.jsx
│       │   ├── ProductDetail.jsx
│       │   ├── Cart.jsx
│       │   ├── Checkout.jsx
│       │   ├── OrdenConfirmacion.jsx
│       │   ├── Account.jsx
│       │   ├── MisOrdenes.jsx
│       │   ├── Facturas.jsx
│       │   ├── Dashboard.jsx
│       │   ├── AdminProducts.jsx
│       │   ├── AdminOrdenes.jsx
│       │   ├── AdminPagos.jsx
│       │   ├── AdminClients.jsx
│       │   ├── AdminReportes.jsx
│       │   ├── AdminAudit.jsx
│       │   └── AdminSettings.jsx
│       ├── services/             # Servicios API (llamadas HTTP)
│       │   ├── authService.js
│       │   ├── productService.js
│       │   ├── orderService.js
│       │   ├── paymentService.js
│       │   ├── invoiceService.js
│       │   ├── clientService.js
│       │   ├── userService.js
│       │   ├── notificationService.js
│       │   ├── reviewService.js
│       │   └── settingsService.js
│       ├── store/                # Estado global (Zustand)
│       │   ├── authStore.js
│       │   ├── cartStore.js
│       │   ├── productStore.js
│       │   ├── orderStore.js
│       │   ├── paymentStore.js
│       │   ├── clientStore.js
│       │   ├── invoiceStore.js
│       │   └── notificationStore.js
│       └── utils/                # Funciones auxiliares
│           └── pdfReports.js
│
└── README.md
```

---

## 4. Configuración Inicial

### 4.1 Clonar el Repositorio

```bash
git clone https://github.com/tu-usuario/licoreriapasito.git
cd licoreriapasito
```

### 4.2 Configurar Backend

#### 4.2.1 Variables de Entorno

1. Navega a la carpeta backend:
```bash
cd backend
```

2. Crea un archivo `.env` en la raíz del backend:
```bash
# .env
PORT=4000
MONGODB_URI=mongodb+srv://usuario:contraseña@cluster.mongodb.net/licoreriapasito?retryWrites=true&w=majority
JWT_SECRET=tu_clave_secreta_super_segura_aqui
NODE_ENV=development
```

#### 4.2.2 Variables de Entorno Explicadas

| Variable | Descripción | Ejemplo |
|----------|-------------|---------|
| `PORT` | Puerto en el que corre el servidor | `4000` |
| `MONGODB_URI` | Cadena de conexión a MongoDB Atlas | `mongodb+srv://user:pass@cluster.mongodb.net/db` |
| `JWT_SECRET` | Clave secreta para firmar JWT | `miClaveSecretaBastanteLarga123!@#` |
| `NODE_ENV` | Entorno de ejecución | `development` o `production` |

#### 4.2.3 Instalar Dependencias del Backend

```bash
npm install
```

#### 4.2.4 Crear Administrador Inicial

```bash
npm run seed:admin
```

#### 4.2.5 Iniciar el Servidor Backend

**Modo desarrollo** (con auto-reload):
```bash
npm run dev
```

**Modo producción**:
```bash
npm start
```

El servidor estará disponible en `http://localhost:4000`

### 4.3 Configurar Frontend

#### 4.3.1 Variables de Entorno

1. Navega a la carpeta frontend:
```bash
cd frontend
```

2. Crea un archivo `.env` en la raíz del frontend:
```bash
# .env
VITE_API_URL=http://localhost:4000/api
VITE_APP_NAME=Licorería Al Pasito
VITE_APP_VERSION=1.0.0
```

#### 4.3.2 Instalar Dependencias del Frontend

```bash
npm install
```

#### 4.3.3 Iniciar el Servidor Frontend

**Modo desarrollo**:
```bash
npm run dev
```

El proyecto estará disponible en `http://localhost:5173`

**Build para producción**:
```bash
npm run build
```

Genera una carpeta `dist/` lista para despliegue.

---

## 5. Arquitectura de la Aplicación

### 5.1 Flujo de Datos

```
Frontend (React/Vite)
    ↓
    ├─→ Zustand Store (Estado global)
    ├─→ Axios (Llamadas HTTP)
    ↓
Backend (Express/Node.js)
    ├─→ Routes (Definición de endpoints)
    ├─→ Controllers (Lógica de negocio)
    ├─→ Middleware (Autenticación, auditoría)
    ├─→ Models (Esquemas de BD)
    ↓
MongoDB (Base de datos)
```

### 5.2 Patrones de Diseño

#### MVC (Model-View-Controller)
- **Models**: Esquemas de datos (`/models`)
- **Views**: Componentes React (`/pages`, `/components`)
- **Controllers**: Lógica empresarial (`/controllers`)

#### REST API
- Endpoints estándar RESTful
- Métodos HTTP: GET, POST, PUT, DELETE, PATCH
- Respuestas en JSON

#### Autenticación JWT
- Tokens generados en login
- Enviados en header `Authorization: Bearer token`
- Validados por middleware en rutas protegidas

---

## 6. API Endpoints

### 6.1 Autenticación

```
POST   /api/auth/register         # Crear nueva cuenta
POST   /api/auth/login            # Iniciar sesión
POST   /api/auth/logout           # Cerrar sesión
POST   /api/auth/refresh          # Refrescar token
POST   /api/auth/forgot-password  # Solicitar recuperación
POST   /api/auth/reset-password   # Restablecer contraseña
```

### 6.2 Productos

```
GET    /api/products              # Listar todos los productos
GET    /api/products/:id          # Obtener producto por ID
POST   /api/products              # Crear nuevo producto (admin)
PUT    /api/products/:id          # Actualizar producto (admin)
DELETE /api/products/:id          # Eliminar producto (admin)
GET    /api/products/search       # Buscar productos
```

### 6.3 Órdenes

```
GET    /api/orders                # Listar órdenes del usuario
GET    /api/orders/:id            # Obtener orden específica
POST   /api/orders                # Crear nueva orden
PUT    /api/orders/:id            # Actualizar estado de orden
DELETE /api/orders/:id            # Cancelar orden
```

### 6.4 Pagos

```
POST   /api/payments              # Procesar pago
GET    /api/payments/:id          # Obtener detalles de pago
PUT    /api/payments/:id          # Actualizar estado de pago
GET    /api/payments/order/:orderId  # Pagos de una orden
```

### 6.5 Facturas

```
GET    /api/invoices              # Listar facturas del usuario
GET    /api/invoices/:id          # Obtener factura específica
POST   /api/invoices              # Generar factura
GET    /api/invoices/:id/pdf      # Descargar factura en PDF
```

### 6.6 Usuarios

```
GET    /api/users/profile         # Obtener perfil actual
PUT    /api/users/profile         # Actualizar perfil
PUT    /api/users/password        # Cambiar contraseña
GET    /api/users                 # Listar usuarios (admin)
DELETE /api/users/:id             # Eliminar usuario (admin)
```

### 6.7 Clientes

```
GET    /api/clients               # Listar clientes (admin)
GET    /api/clients/:id           # Obtener cliente (admin)
PUT    /api/clients/:id           # Actualizar cliente (admin)
DELETE /api/clients/:id           # Eliminar cliente (admin)
```

### 6.8 Reportes

```
GET    /api/reports/sales         # Reporte de ventas
GET    /api/reports/products      # Reporte de productos
GET    /api/reports/clients       # Reporte de clientes
GET    /api/reports/export        # Exportar reportes
```

### 6.9 Auditoría

```
GET    /api/audit                 # Listar registros de auditoría
GET    /api/audit/user/:userId    # Auditoría de usuario específico
GET    /api/audit/action/:action  # Registros de acción específica
```

### 6.10 Notificaciones

```
GET    /api/notifications         # Obtener notificaciones del usuario
POST   /api/notifications/:id/read # Marcar como leída
DELETE /api/notifications/:id     # Eliminar notificación
```

### 6.11 Reseñas

```
GET    /api/reviews/:productId    # Obtener reseñas de producto
POST   /api/reviews               # Crear reseña
DELETE /api/reviews/:id           # Eliminar reseña (admin/propietario)
```

---

## 7. Modelos de Base de Datos

### 7.1 Modelo Users

```javascript
{
  _id: ObjectId,
  nombre: String,
  email: String (único),
  contraseña: String (hasheada),
  role: String (enum: ['cliente', 'admin']),
  telefono: String,
  direccion: String,
  ciudad: String,
  codigoPostal: String,
  activo: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

### 7.2 Modelo Product

```javascript
{
  _id: ObjectId,
  nombre: String,
  descripcion: String,
  categoria: String,
  precio: Number,
  stock: Number,
  imagen: String (URL),
  volumen: String,
  porcentajeAlcohol: Number,
  activo: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

### 7.3 Modelo Order

```javascript
{
  _id: ObjectId,
  numeroOrden: String (único),
  usuarioId: ObjectId (ref: Users),
  productos: [
    {
      productoId: ObjectId,
      nombre: String,
      cantidad: Number,
      precioUnitario: Number,
      subtotal: Number
    }
  ],
  total: Number,
  estado: String (enum: ['pendiente', 'confirmada', 'despachada', 'entregada', 'cancelada']),
  direccionEntrega: String,
  telefonoContacto: String,
  instrucciones: String,
  pagada: Boolean,
  createdAt: Date,
  updatedAt: Date
}
```

### 7.4 Modelo Payment

```javascript
{
  _id: ObjectId,
  ordenId: ObjectId (ref: Order),
  usuarioId: ObjectId (ref: Users),
  monto: Number,
  metodo: String (enum: ['tarjeta', 'transferencia', 'efectivo']),
  referencia: String,
  estado: String (enum: ['pendiente', 'completado', 'fallido', 'reembolsado']),
  detalles: Object,
  createdAt: Date,
  updatedAt: Date
}
```

### 7.5 Modelo Invoice

```javascript
{
  _id: ObjectId,
  numeroFactura: String (único),
  ordenId: ObjectId (ref: Order),
  usuarioId: ObjectId (ref: Users),
  productos: Array,
  subtotal: Number,
  impuestos: Number,
  total: Number,
  estado: String,
  ruta: String (PDF path),
  createdAt: Date
}
```

### 7.6 Otros Modelos

- **Notification**: Notificaciones a usuarios
- **Review**: Reseñas y calificaciones de productos
- **Audit**: Registro de acciones administrativas
- **Settings**: Configuración de la aplicación
- **Client**: Información adicional de clientes

---

## 8. Autenticación y Autorización

### 8.1 Flujo de Autenticación

```
Usuario

    ↓ Credenciales
    
Endpoint /login
    ↓
Verificar credenciales contra DB
    ↓
   ✓ Válidas → Generar JWT
   ✗ Inválidas → Error 401
    ↓
Retornar token en respuesta
    ↓
Cliente almacena token en localStorage
    ↓
Token se envía en header Authorization
```

### 8.2 Middleware de Autenticación

En `backend/src/middleware/auth.middleware.js`:

```javascript
const verifyToken = (req, res, next) => {
  const token = req.headers.authorization?.split(' ')[1];
  
  if (!token) {
    return res.status(401).json({ message: 'Token no proporcionado' });
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.userId = decoded.id;
    req.userRole = decoded.role;
    next();
  } catch (error) {
    return res.status(401).json({ message: 'Token inválido' });
  }
};
```

### 8.3 Roles y Permisos

| Rol | Permisos |
|-----|----------|
| **Cliente** | Ver catálogo, comprar, ver mis órdenes, dejar reseñas |
| **Admin** | Todo + gestionar productos, órdenes, clientes, pagos, reportes, auditoría |

### 8.4 Proteger una Ruta

```javascript
// En routes
router.post('/crear', verifyToken, verificarAdmin, ordenController.crear);

// Middleware para verificar admin
const verificarAdmin = (req, res, next) => {
  if (req.userRole !== 'admin') {
    return res.status(403).json({ message: 'Acceso denegado' });
  }
  next();
};
```

---
## 10. Servicios API

### 10.1 Estructura de Servicios

Cada servicio en `frontend/src/services/` es un módulo que encapsula llamadas API.

#### Ejemplo: productService.js

```javascript
import axios from 'axios';

const API_URL = `${import.meta.env.VITE_API_URL}/products`;

const productService = {
  // Obtener todos los productos
  getAll: async (filters = {}) => {
    const response = await axios.get(API_URL, { params: filters });
    return response.data;
  },
  
  // Obtener producto por ID
  getById: async (id) => {
    const response = await axios.get(`${API_URL}/${id}`);
    return response.data;
  },
  
  // Crear producto (admin)
  create: async (data) => {
    const token = localStorage.getItem('token');
    const response = await axios.post(API_URL, data, {
      headers: { Authorization: `Bearer ${token}` }
    });
    return response.data;
  },
  
  // Actualizar producto (admin)
  update: async (id, data) => {
    const token = localStorage.getItem('token');
    const response = await axios.put(`${API_URL}/${id}`, data, {
      headers: { Authorization: `Bearer ${token}` }
    });
    return response.data;
  },
  
  // Eliminar producto (admin)
  delete: async (id) => {
    const token = localStorage.getItem('token');
    const response = await axios.delete(`${API_URL}/${id}`, {
      headers: { Authorization: `Bearer ${token}` }
    });
    return response.data;
  }
};

export default productService;
```

### 10.2 Usar Servicios en Componentes

```javascript
import productService from '../services/productService';

function ListaProductos() {
  const [productos, setProductos] = useState([]);
  
  useEffect(() => {
    productService.getAll().then(data => {
      setProductos(data);
    }).catch(error => {
      console.error('Error:', error);
    });
  }, []);
  
  return (
    <div>
      {productos.map(p => (
        <div key={p._id}>{p.nombre}</div>
      ))}
    </div>
  );
}
```

---

## 11. Desarrollo Frontend

### 11.1 Creación de Componentes

#### Estructura de Componente

```javascript
// src/components/MiComponente.jsx
import React, { useState, useEffect } from 'react';
import './MiComponente.css'; // Estilos específicos (opcional)

function MiComponente({ prop1, prop2 }) {
  const [state, setState] = useState('');
  
  useEffect(() => {
    // Lógica de inicialización
  }, []);
  
  const handleClick = () => {
    // Manejar evento
  };
  
  return (
    <div className="mi-componente">
      <h1>{prop1}</h1>
      <p>{state}</p>
      <button onClick={handleClick}>Hacer algo</button>
    </div>
  );
}

export default MiComponente;
```

### 11.2 Routing

En `src/App.jsx`:

```javascript
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import Home from './pages/Home';
import Login from './pages/Login';
import Catalog from './pages/Catalog';
import Cart from './pages/Cart';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/login" element={<Login />} />
        <Route path="/catalog" element={<Catalog />} />
        <Route path="/cart" element={<Cart />} />
      </Routes>
    </BrowserRouter>
  );
}

export default App;
```

### 11.3 Estilos con Tailwind

```javascript
// Usar clases de Tailwind directamente
<div className="bg-blue-500 p-4 rounded-lg shadow-lg">
  <h1 className="text-2xl font-bold text-white mb-2">Título</h1>
  <p className="text-gray-100">Descripción</p>
  <button className="bg-white text-blue-500 px-4 py-2 rounded hover:bg-gray-100">
    Botón
  </button>
</div>
```

---

## 12. Desarrollo Backend

### 12.1 Crear un Controlador

```javascript
// src/controllers/ejemplo.controller.js
import EjemploModel from '../models/Ejemplo.js';

export const obtenerTodos = async (req, res) => {
  try {
    const ejemplos = await EjemploModel.find();
    res.status(200).json(ejemplos);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};

export const obtenerPorId = async (req, res) => {
  try {
    const { id } = req.params;
    const ejemplo = await EjemploModel.findById(id);
    
    if (!ejemplo) {
      return res.status(404).json({ message: 'No encontrado' });
    }
    
    res.status(200).json(ejemplo);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};

export const crear = async (req, res) => {
  try {
    const nuevoEjemplo = new EjemploModel(req.body);
    const resultado = await nuevoEjemplo.save();
    res.status(201).json(resultado);
  } catch (error) {
    res.status(400).json({ message: error.message });
  }
};

export const actualizar = async (req, res) => {
  try {
    const { id } = req.params;
    const actualizado = await EjemploModel.findByIdAndUpdate(
      id,
      req.body,
      { new: true, runValidators: true }
    );
    res.status(200).json(actualizado);
  } catch (error) {
    res.status(400).json({ message: error.message });
  }
};

export const eliminar = async (req, res) => {
  try {
    const { id } = req.params;
    await EjemploModel.findByIdAndDelete(id);
    res.status(200).json({ message: 'Eliminado correctamente' });
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
};
```

### 12.2 Crear un Modelo

```javascript
// src/models/Ejemplo.js
import mongoose from 'mongoose';

const ejemploSchema = new mongoose.Schema(
  {
    nombre: {
      type: String,
      required: [true, 'El nombre es requerido'],
      unique: true,
      trim: true
    },
    descripcion: {
      type: String,
      default: ''
    },
    precio: {
      type: Number,
      required: true,
      min: [0, 'El precio debe ser positivo']
    },
    activo: {
      type: Boolean,
      default: true
    }
  },
  { timestamps: true }
);

export default mongoose.model('Ejemplo', ejemploSchema);
```

### 12.3 Crear Rutas

```javascript
// src/routes/ejemplo.routes.js
import express from 'express';
import * as ejemploController from '../controllers/ejemplo.controller.js';
import { verifyToken, verificarAdmin } from '../middleware/auth.middleware.js';

const router = express.Router();

// Rutas públicas
router.get('/', ejemploController.obtenerTodos);
router.get('/:id', ejemploController.obtenerPorId);

// Rutas protegidas (admin)
router.post('/', verifyToken, verificarAdmin, ejemploController.crear);
router.put('/:id', verifyToken, verificarAdmin, ejemploController.actualizar);
router.delete('/:id', verifyToken, verificarAdmin, ejemploController.eliminar);

export default router;
```

### 12.4 Registrar Rutas en index.js

```javascript
// En src/index.js
import ejemploRoutes from './routes/ejemplo.routes.js';

app.use('/api/ejemplo', ejemploRoutes);
```

---

## 13. Gestión de Errores

### 13.1 Backend

```javascript
// Middleware de errores personalizado
app.use((err, req, res, next) => {
  console.error(err.stack);
  
  const status = err.status || 500;
  const message = err.message || 'Error interno del servidor';
  
  res.status(status).json({
    success: false,
    message,
    ...(process.env.NODE_ENV === 'development' && { error: err })
  });
});
```

### 13.2 Frontend

```javascript
// Manejo de errores en servicios
import axios from 'axios';

const axiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_URL
});

axiosInstance.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      // Redirigir a login
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default axiosInstance;
```

---
---

## 14. Mejores Prácticas

### 14.1 Código Limpio

- Usa nombres descriptivos para variables y funciones
- Comenta secciones complejas
- Mantén funciones pequeñas y enfocadas
- Sigue convenciones de nombrado (camelCase, UPPER_CASE, kebab-case)

### 14.2 Seguridad

- Nunca hardcodees credenciales (usa .env)
- Valida inputs en servidor y cliente
- Usa HTTPS en producción
- Implementa rate limiting
- Usa contraseñas hasheadas (bcrypt)
- Sanitiza inputs para evitar inyección SQL/NoSQL

### 14.3 Rendimiento

- Implementa paginación en listados largos
- Usa lazy loading para imágenes
- Implementa caching del lado cliente
- Optimiza queries de BD (indexa campos frecuentes)
- Minimiza bundles JavaScript

### 14.4 Testing

- Escribe tests para funciones críticas
- Usa pruebas unitarias (Jest)
- Prueba APIs con Postman
- Realiza pruebas de integración

---
